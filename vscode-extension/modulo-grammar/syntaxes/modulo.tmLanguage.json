{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "Modulo",
  "scopeName": "source.modulo",
  "patterns": [
    {"include": "#comments"},
    {"include": "#keywords"},
    {"include": "#operators"},
    {"include": "#numbers"},
    {"include": "#strings"},
    {"include": "#identifiers"},
    {"include": "#sections"},
    {"include": "#program_config"},
    {"include": "#bytecode"},
    {"include": "#calls"},
    {"include": "#comparisons"},
    {"include": "#choose"},
    {"include": "#punctuation"}
  ],
  "repository": {
    "comments": {
      "patterns": [
        {
          "name": "comment.line.double-slash.modulo",
          "match": "//.*$"
        }
      ]
    },
    
    "keywords": {
      "patterns": [
        {
          "name": "keyword.control.modulo",
          "match": "\\b(if|else|elseif|choose)\\b"
        },
        {
          "name": "keyword.declaration.modulo",
          "match": "\\b(var|const|VAR|CONST|section)\\b"
        },
        {
          "name": "keyword.other.modulo",
          "match": "\\b(bytecode|as|true|false)\\b"
        }
      ]
    },
    
    "program_config": {
      "patterns": [
        {
          "name": "entity.name.type.program.modulo",
          "match": "\\b(program\\.(run|set))\\b"
        },
        {
          "name": "support.constant.config.modulo",
          "match": "\\b(mode|optimize|repeat|parallel|timeout|onerror|trace|order|debug|release|speed|size|continue|stop|name|author|version|description|license|homepage|created|tags)\\b"
        }
      ]
    },
    
    "operators": {
      "patterns": [
        {
          "name": "keyword.operator.arithmetic.modulo",
          "match": "(\\+|\\-|\\*|/|\\+\\+)"
        },
        {
          "name": "keyword.operator.comparison.modulo",
          "match": "(==|!=|>|<|>=|<=)"
        },
        {
          "name": "keyword.operator.assignment.modulo",
          "match": "(=>|:|\\.\\.|\\.)"
        }
      ]
    },
    
    "comparisons": {
      "patterns": [
        {
          "name": "keyword.operator.comparison.modulo",
          "match": "\\b(==|!=|>|<|>=|<=)\\b"
        }
      ]
    },
    
    "numbers": {
      "patterns": [
        {
          "name": "constant.numeric.decimal.modulo",
          "match": "\\b\\d+\\b"
        }
      ]
    },
    
    "strings": {
      "patterns": [
        {
          "name": "string.quoted.double.modulo",
          "begin": "\"",
          "end": "\"",
          "patterns": [
            {
              "name": "constant.character.escape.modulo",
              "match": "\\\\."
            }
          ]
        }
      ]
    },
    
    "bytecode": {
      "patterns": [
        {
          "name": "keyword.control.bytecode.modulo",
          "begin": "bytecode\\s+\"",
          "end": "\"",
          "beginCaptures": {
            "0": {"name": "keyword.control.bytecode.modulo"}
          },
          "endCaptures": {
            "0": {"name": "string.quoted.double.modulo"}
          },
          "patterns": [
            {
              "name": "constant.numeric.hex.modulo",
              "match": "[0-9A-Fa-f]+"
            }
          ]
        }
      ]
    },
    
    "calls": {
      "patterns": [
        {
          "name": "support.function.io.modulo",
          "begin": "io\\.(print|warn|error|input)\\b",
          "end": "(?=\\s|;|$|\\))",
          "beginCaptures": {
            "0": {"name": "support.function.io.modulo"}
          }
        },
        {
          "name": "support.function.call.modulo",
          "match": "\\b[a-zA-Z_][a-zA-Z0-9_]*\\s*(?=\\()"
        }
      ]
    },
    
    "choose": {
      "patterns": [
        {
          "name": "keyword.control.choose.modulo",
          "begin": "choose\\s*\\{",
          "end": "\\}",
          "beginCaptures": {
            "0": {"name": "keyword.control.choose.modulo"}
          },
          "patterns": [
            {"include": "#numbers"},
            {"include": "#strings"},
            {"include": "#operators"},
            {"include": "$self"}
          ]
        }
      ]
    },
    
    "sections": {
      "patterns": [
        {
          "name": "entity.name.section.modulo",
          "begin": "section\\s+",
          "end": "\\s*\\{\\{",
          "beginCaptures": {
            "0": {"name": "keyword.declaration.modulo"}
          },
          "endCaptures": {
            "0": {"name": "punctuation.section.begin.modulo"}
          },
          "patterns": [
            {
              "name": "variable.other.section.modulo",
              "match": "\\b[a-zA-Z_][a-zA-Z0-9_]*\\b"
            }
          ]
        },
        {
          "name": "punctuation.section.end.modulo",
          "match": "\\}\\}"
        }
      ]
    },
    
    "identifiers": {
      "patterns": [
        {
          "name": "variable.other.modulo",
          "match": "\\b[a-zA-Z_][a-zA-Z0-9_]*\\b"
        },
        {
          "name": "variable.language.program.modulo",
          "match": "\\bprogram\\b"
        }
      ]
    },
    
    "punctuation": {
      "patterns": [
        {
          "name": "punctuation.parenthesis.round.modulo",
          "match": "\\(|\\)"
        },
        {
          "name": "punctuation.parenthesis.square.modulo",
          "match": "\\[|\\]"
        },
        {
          "name": "punctuation.brace.curly.modulo",
          "match": "\\{|\\}"
        },
        {
          "name": "punctuation.separator.comma.modulo",
          "match": ","
        },
        {
          "name": "punctuation.separator.colon.modulo",
          "match": ":"
        }
      ]
    }
  }
}